<!DOCTYPE html>
<html>
<head>
<title>Final Copy Panel - Share Enabled</title>
<style>
body{font-family:Arial;padding:20px}
table{border-collapse:collapse;width:100%}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#f2f2f2}
td.clickable{cursor:pointer}
td.green{background:#90ee90!important}
button{padding:6px 10px;margin-top:5px;cursor:pointer}
#copiedMsg{margin-top:10px;font-size:13px;color:green;display:none}
input{padding:5px;margin-bottom:10px}
#shareLink{width:100%;margin-top:5px}
</style>
</head>
<body>

<h2>Username Password Copy Panel</h2>

<button onclick="generateShareLink()">Save & Generate Share Link</button>
<input type="text" id="shareLink" readonly>

<br><br>

<label>Filter by Serial No:</label>
<input type="text" id="filterInput" onkeyup="filterTable()" placeholder="Enter Serial No">

<table id="dataTable">
<thead>
<tr>
<th>Serial No</th>
<th>Username</th>
<th>Password</th>
<th>Undo</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div id="copiedMsg">✔ Copied</div>

<script>

const data = [...]; 
// ⚠️ IMPORTANT:
// Yahan apna pura data array paste karo (jo aapka already fixed version hai).
// Maine short kiya hai message length bachane ke liye.
// Sirf ensure karo har entry ke baad comma ho (last ke alawa).

const tbody=document.querySelector("#dataTable tbody");
const msg=document.getElementById("copiedMsg");
let greenCells = new Set();

data.forEach((item,index)=>{
let row=document.createElement("tr");
row.innerHTML=`
<td>${index+1}</td>
<td class="clickable" onclick="copyText(this,'${item[0]}',${index},1)">${item[0]}</td>
<td class="clickable" onclick="copyText(this,'${item[1]}',${index},2)">${item[1]}</td>
<td><button onclick="undoRow(${index})">Undo</button></td>`;
tbody.appendChild(row);
});

function copyText(cell,text,row,col){
navigator.clipboard.writeText(text);
cell.classList.add("green");

let key = row+"-"+col;
greenCells.add(key);

msg.style.display="block";
setTimeout(()=>{msg.style.display="none";},800);
}

function undoRow(rowIndex){
let row = tbody.rows[rowIndex];
row.querySelectorAll("td.clickable").forEach((td,i)=>{
td.classList.remove("green");
greenCells.delete(rowIndex+"-"+(i+1));
});
}

function filterTable(){
let input=document.getElementById("filterInput").value;
let rows=tbody.getElementsByTagName("tr");
for(let i=0;i<rows.length;i++){
let serial=rows[i].getElementsByTagName("td")[0].innerText;
rows[i].style.display=serial.includes(input)?"":"none";
}
}

function generateShareLink(){
let baseUrl = window.location.origin + window.location.pathname;
let params = [...greenCells].join(",");
let finalUrl = baseUrl + "?green=" + params;
document.getElementById("shareLink").value = finalUrl;
navigator.clipboard.writeText(finalUrl);
alert("Share link copied!");
}

window.onload = function(){
let urlParams = new URLSearchParams(window.location.search);
let greenParam = urlParams.get("green");

if(greenParam){
let cells = greenParam.split(",");
cells.forEach(key=>{
let [row,col] = key.split("-");
let tableRow = tbody.rows[row];
if(tableRow){
let cell = tableRow.cells[col];
if(cell){
cell.classList.add("green");
greenCells.add(key);
}
}
});
}
}

</script>
</body>
</html>
